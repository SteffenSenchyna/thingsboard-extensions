<!--
  Copyright Â© 2016-2025 The Thingsboard Authors

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<div [formGroup]="ts302ConfigForm" class="flex size-full max-w-full flex-col">
  <mat-toolbar color="primary" [class.page-header]="!dialogRef">
    <div class="tb-flex space-between align-center h-16">
      <h2><div tbTruncateWithTooltip>TS302 Sensor Configuration</div></h2>
      <div class="flex items-center">
        <button *ngIf="dialogRef" mat-icon-button (click)="cancel()" type="button">
          <mat-icon class="material-icons">close</mat-icon>
        </button>
      </div>
    </div>
  </mat-toolbar>

  <div class="content-wrapper flex-1 overflow-y-auto p-4">
    <mat-accordion>
      <!-- Basic Settings Section -->
      <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
          <mat-panel-title>Basic Settings</mat-panel-title>
        </mat-expansion-panel-header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
          <mat-form-field class="w-full">
            <mat-label>Report Interval (seconds)</mat-label>
            <input matInput type="number" formControlName="reportInterval" />
            <mat-error *ngIf="ts302ConfigForm.get('reportInterval').hasError('required')">
              Report interval is required
            </mat-error>
            <mat-error *ngIf="ts302ConfigForm.get('reportInterval').hasError('min')">
              Must be at least 1
            </mat-error>
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Collection Interval (seconds)</mat-label>
            <input matInput type="number" formControlName="collectionInterval" />
            <mat-error *ngIf="ts302ConfigForm.get('collectionInterval').hasError('required')">
              Collection interval is required
            </mat-error>
            <mat-error *ngIf="ts302ConfigForm.get('collectionInterval').hasError('min')">
              Must be at least 1
            </mat-error>
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Time Zone</mat-label>
            <mat-select formControlName="timeZone">
              <mat-option *ngFor="let tz of timezoneOptions" [value]="tz">
                {{ tz }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Time Display</mat-label>
            <mat-select formControlName="timeDisplay">
              <mat-option *ngFor="let option of timeDisplayOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Temperature Unit Display</mat-label>
            <mat-select formControlName="temperatureUnitDisplay">
              <mat-option *ngFor="let option of temperatureUnitOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <div class="flex flex-col gap-2">
            <mat-checkbox formControlName="syncTime">
              Sync Time
            </mat-checkbox>

            <mat-checkbox formControlName="displayEnable">
              Display Enable
            </mat-checkbox>
          </div>
        </div>
      </mat-expansion-panel>

      <!-- Sensor Channels Section -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Sensor Channels</mat-panel-title>
        </mat-expansion-panel-header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
          <mat-form-field class="w-full">
            <mat-label>Sensor Channel 1</mat-label>
            <mat-select formControlName="sensorChn1">
              <mat-option *ngFor="let option of sensorTypeOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Sensor Channel 2</mat-label>
            <mat-select formControlName="sensorChn2">
              <mat-option *ngFor="let option of sensorTypeOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Channel 1 Calibration Section -->
      <mat-expansion-panel formGroupName="temperatureChn1CalibrationSettings">
        <mat-expansion-panel-header>
          <mat-panel-title>Channel 1 Calibration Settings</mat-panel-title>
        </mat-expansion-panel-header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
          <mat-checkbox formControlName="enable">
            Enable Calibration
          </mat-checkbox>

          <mat-form-field class="w-full">
            <mat-label>Calibration Value</mat-label>
            <input matInput type="number" formControlName="calibrationValue" />
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Channel 2 Calibration Section -->
      <mat-expansion-panel formGroupName="temperatureChn2CalibrationSettings">
        <mat-expansion-panel-header>
          <mat-panel-title>Channel 2 Calibration Settings</mat-panel-title>
        </mat-expansion-panel-header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
          <mat-checkbox formControlName="enable">
            Enable Calibration
          </mat-checkbox>

          <mat-form-field class="w-full">
            <mat-label>Calibration Value</mat-label>
            <input matInput type="number" formControlName="calibrationValue" />
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Channel 1 Alarm Configuration Section -->
      <mat-expansion-panel formGroupName="temperatureChn1AlarmConfig">
        <mat-expansion-panel-header>
          <mat-panel-title>Channel 1 Alarm Configuration</mat-panel-title>
        </mat-expansion-panel-header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
          <div class="flex flex-col gap-2 md:col-span-2">
            <mat-checkbox formControlName="enable">
              Enable Alarm
            </mat-checkbox>

            <mat-checkbox formControlName="alarmReleaseEnable">
              Enable Alarm Release
            </mat-checkbox>
          </div>

          <mat-form-field class="w-full">
            <mat-label>Condition</mat-label>
            <mat-select formControlName="condition">
              <mat-option *ngFor="let option of alarmConditionOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Threshold Min</mat-label>
            <input matInput type="number" formControlName="thresholdMin" />
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Threshold Max</mat-label>
            <input matInput type="number" formControlName="thresholdMax" />
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Alarm Reporting Times</mat-label>
            <input matInput type="number" formControlName="alarmReportingTimes" />
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Alarm Reporting Interval</mat-label>
            <input matInput type="number" formControlName="alarmReportingInterval" />
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Channel 2 Alarm Configuration Section -->
      <mat-expansion-panel formGroupName="temperatureChn2AlarmConfig">
        <mat-expansion-panel-header>
          <mat-panel-title>Channel 2 Alarm Configuration</mat-panel-title>
        </mat-expansion-panel-header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
          <div class="flex flex-col gap-2 md:col-span-2">
            <mat-checkbox formControlName="enable">
              Enable Alarm
            </mat-checkbox>

            <mat-checkbox formControlName="alarmReleaseEnable">
              Enable Alarm Release
            </mat-checkbox>
          </div>

          <mat-form-field class="w-full">
            <mat-label>Condition</mat-label>
            <mat-select formControlName="condition">
              <mat-option *ngFor="let option of alarmConditionOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Threshold Min</mat-label>
            <input matInput type="number" formControlName="thresholdMin" />
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Threshold Max</mat-label>
            <input matInput type="number" formControlName="thresholdMax" />
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Alarm Reporting Times</mat-label>
            <input matInput type="number" formControlName="alarmReportingTimes" />
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Alarm Reporting Interval</mat-label>
            <input matInput type="number" formControlName="alarmReportingInterval" />
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Channel 1 Mutation Alarm Section -->
      <mat-expansion-panel formGroupName="temperatureChn1MutationAlarmConfig">
        <mat-expansion-panel-header>
          <mat-panel-title>Channel 1 Mutation Alarm Configuration</mat-panel-title>
        </mat-expansion-panel-header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
          <mat-checkbox formControlName="enable">
            Enable Mutation Alarm
          </mat-checkbox>

          <mat-form-field class="w-full">
            <mat-label>Mutation Value</mat-label>
            <input matInput type="number" formControlName="mutation" />
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Channel 2 Mutation Alarm Section -->
      <mat-expansion-panel formGroupName="temperatureChn2MutationAlarmConfig">
        <mat-expansion-panel-header>
          <mat-panel-title>Channel 2 Mutation Alarm Configuration</mat-panel-title>
        </mat-expansion-panel-header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
          <mat-checkbox formControlName="enable">
            Enable Mutation Alarm
          </mat-checkbox>

          <mat-form-field class="w-full">
            <mat-label>Mutation Value</mat-label>
            <input matInput type="number" formControlName="mutation" />
          </mat-form-field>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>

  <div class="flex h-full items-center justify-end gap-2 p-4">
    @if (dialogRef) {
      <button mat-button color="primary" type="button" (click)="cancel()">
        {{ 'action.cancel' | translate }}
      </button>
    }
    <button mat-raised-button color="primary"
            type="button"
            [disabled]="ts302ConfigForm.invalid || !ts302ConfigForm.dirty"
            (click)="saveConfig()">
      {{ 'action.save' | translate }}
    </button>
  </div>
</div>
